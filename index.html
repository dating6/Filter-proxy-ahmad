<!DOCTYPE html>
<html>
<head>
    <title>Checking Connection...</title>
    <meta charset="UTF-8">
    <style>
        /* (Ù†ÙØ³ Ø§Ù„Ù€ CSS Ù…Ù† Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø³Ø§Ø¨Ù‚) */
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; background: #222; color: #eee; text-align: center; padding-top: 100px; display: flex; justify-content: center; align-items: center; flex-direction: column; }
        h1 { font-size: 24px; font-weight: 500; }
        .spinner { border: 4px solid #f3f3f3; border-top: 4px solid #3498db; border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; margin-top: 20px; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>

    <h1>Ø³Ø¹ÙŠØ¯ Ø§Ø³ØªÙ†Ù‰ Ø´ÙˆÙŠ Ù„Ù†ÙØ­Øµ Ø§Ù„Ø¨Ø±ÙˆÙƒØ³ÙŠ ØªØ¨Ø¹Ùƒ ÙŠØ§ Ø­Ø¨ÙŠØ¨ÙŠğŸ˜</h1>
    <div class="spinner"></div>

    <script>
        // --- Ø§Ù„Ø±ÙˆØ§Ø¨Ø· Ø§Ù„Ø®Ø§ØµØ© Ø¨Ùƒ ---
        const TARGET_URL_CLEAN = "https://omjw2.bemobtrcks.com/go/aa1580be-1693-445d-800d-1986cbd284c4?bid=[bid]&clickid=[clickid]&campaignid=1092434&campaignname=avg-cpi-camping-filter&siteid=520804&category=software&connection=[connection]&os=[operatingsystem]&device=[device]&browser=[browser]&country=[cc]";
        const TARGET_URL_PROXY = "https://google.com"; 
        const API_KEY = "9a30j1-ia8bq4-62sjl1-836307"; // Ù…ÙØªØ§Ø­Ùƒ

        // --- Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ù…ØªÙˆØ§Ø²Ù† (Fail-Open) ---

        (function() {
            fetch('https://api.ipify.org?format=json')
                .then(response => response.json())
                .then(data => {
                    checkProxyStatus(data.ip);
                })
                .catch(error => {
                    // Ø¥Ø°Ø§ ÙØ´Ù„ Ø¬Ù„Ø¨ Ø§Ù„Ù€ IPØŒ Ø§Ø¹ØªØ¨Ø±Ù‡ Ù†Ø¸ÙŠÙØ§Ù‹
                    console.error("Error fetching IP. Failing open.", error);
                    window.location.replace(TARGET_URL_CLEAN); 
                });
        })();

        function checkProxyStatus(visitor_ip) {
            // !! ØªØ¹Ø¯ÙŠÙ„: Ø£Ø²Ù„Ù†Ø§ risk=1 Ùˆ vpn=1 ÙƒØ§ÙÙŠØ©
            const api_url = `https://proxycheck.io/v2/${visitor_ip}?key=${API_KEY}&vpn=1`;

            fetch(api_url)
                .then(response => response.json())
                .then(data => {
                    let is_fraud = false;
                    
                    if (data.status === 'ok' && data[visitor_ip]) {
                        // --- Ù‡Ø°Ø§ Ù‡Ùˆ Ø§Ù„ÙØ­Øµ Ø§Ù„Ù…Ù‡Ù… ---
                        // 1. ØªØ­Ù‚Ù‚ Ø¥Ø°Ø§ ÙƒØ§Ù† Ø¨Ø±ÙˆÙƒØ³ÙŠ
                        if (data[visitor_ip].proxy === 'yes') {
                            is_fraud = true;
                        }
                        // 2. ØªØ­Ù‚Ù‚ Ø¥Ø°Ø§ ÙƒØ§Ù† VPN
                        if (data[visitor_ip].type === 'VPN') {
                            is_fraud = true;
                        }
                        // !! ØªÙ… Ø­Ø°Ù ÙØ­Øµ Ø¯Ø±Ø¬Ø© Ø§Ù„Ø®Ø·ÙˆØ±Ø© (Risk) !!
                        
                    } else if (data.status === 'error') {
                        // Ø¥Ø°Ø§ Ø§Ù„Ø®Ø¯Ù…Ø© Ø±Ø¬Ø¹Øª Ø®Ø·Ø£ (Ø®Ù„ØµØª Ø§Ù„Ø­ØµØ©)ØŒ Ø§Ø¹ØªØ¨Ø±Ù‡ Ù†Ø¸ÙŠÙØ§Ù‹
                        console.error("API Error:", data.message);
                        is_fraud = false; 
                    }

                    // --- ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ù…Ù†Ø·Ù‚ ---
                    if (is_fraud) {
                        // Ø¨Ø±ÙˆÙƒØ³ÙŠ Ø£Ùˆ VPN
                        window.location.replace(TARGET_URL_PROXY);
                    } else {
                        // Ù†Ø¸ÙŠÙ
                        window.location.replace(TARGET_URL_CLEAN);
                    }
                })
                .catch(error => {
                    // Ø¥Ø°Ø§ ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø¯Ù…Ø©ØŒ Ø§Ø¹ØªØ¨Ø±Ù‡ Ù†Ø¸ÙŠÙØ§Ù‹
                    console.error("Error checking proxy. Failing open.", error);
                    window.location.replace(TARGET_URL_CLEAN); 
                });
        }
    </script>

</body>
</html>
